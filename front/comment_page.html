<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  </head>
  <body>
    <header id="Story_Name" class="mx-3 mt-3"></header>
    <div id="new_comment" class="mx-3">
        <div class="card" style="width: 30rem;">
          <h4 id="comment_header" class="card-header">New Comments</h4>
          <div id="stories" class="card-body my-2" style="width: 30rem;"></div>
        </div>
    </div>
    <div id="other_comments">
      <h4 id="comment_header" class="card-header">Comments</h4>
        <p class="loading">Loading comments...</p>
    </div>
  </body>
  <footer id="links" class="bg-dark fixed-bottom p-2">
    <a href="/story?" id="back" class="text-white float-left">Back</a>
    <a href="/auth" id="log" class="text-white float-right">Log in with Google</a>
  </footer>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>

  const story_id = new URLSearchParams(window.location.search).get('story_id');
  $('#back').attr('href', `/story?id=${story_id}`);
  console.log(story_id);
  function goBack() {
      window.history.back();
  }

    //template for the comments that will be displayed // given ids so that they can be styled
    const commentArticle = function(comment){
      return $(`
        <article>
          <h1 comment_author="comment_title">${comment.author}</h1>
            <p id="comment_author"><a href="profile?author=${comment.author.id}">${comment.author.name}</a></p>
            <p id="comment_text">${comment.text}</p>
            <a class="delete" href="#">[Delete]</a>
        </article>
      `)};

    $.ajax({method: 'GET', url: `/comments?${story_id}`})
      .fail(() => $('#comments .loading').text('Could not load comments!'))
      .done(function(comments) {
        $('#other_comments .loading').remove();
        console.log(comments)
        $('#other_comments').append(comments.map(comment => commentArticle(comment)));
      });


  </script>
</html>
